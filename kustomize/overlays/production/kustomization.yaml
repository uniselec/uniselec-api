apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Define o namespace para todos os recursos
namespace: uniselec-api-prd

resources:
- ../../base
- namespace.yaml

# inicio - MariaDB para production
patches:
- path: patch-deployment.yaml
- path: patch-ingress.yaml
- path: patch-hpa.yaml
- path: mariadb/patch-statefulset.yaml
  target:
    kind: StatefulSet
    name: mariadb
# fim - MariaDB

# inicio - Override de variáveis do MariaDB para production
configMapGenerator:
- behavior: merge
  literals:
  - DB_DATABASE=uniselec_prod
  - MYSQL_DATABASE=uniselec_prod
  - MARIADB_CLUSTER_NAME=uniselec_prod_galera_cluster
  - MARIADB_CLUSTER_ADDRESS=gcomm://mariadb-0.mariadb.uniselec-api-prd.svc.cluster.local:4567
  - MARIADB_MASTER_HOST=mariadb-0.mariadb.uniselec-api-prd.svc.cluster.local
  - MARIADB_MASTER_WORKER1=mariadb-1.mariadb.uniselec-api-prd.svc.cluster.local
  - MARIADB_MASTER_WORKER2=mariadb-2.mariadb.uniselec-api-prd.svc.cluster.local
  - MESSAGE="Production"
  - MAIL_FROM_NAME="Isto é Um Teste do Ambiente de Produção - Seleções - UNILAB"
  - MAIL_FROM_ADDRESS="noreply@selecoes.unilab.edu.br"

  name: mariadb-env
# fim - Override de variáveis

images:
- name: dti-registro.unilab.edu.br/unilab/uniselec-api
  newTag: v1.0.1
